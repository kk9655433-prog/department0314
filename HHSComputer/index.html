<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>電腦入侵中……</title>
<style>
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  background:url('/department0314/images/XP.jpg') no-repeat center/cover;
  font-family:system-ui;
}
.desktop{
  height:100%;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:16px;
  align-items:flex-start;
}
.icon{
  width:80px;
  display:flex;
  flex-direction:column;
  align-items:center;
  cursor:pointer;
  color:white;
  font-size:14px;
  text-align:center;
  text-shadow:0 2px 4px black;
  user-select:none;
}
.icon img{
  width:48px;
  height:48px;
  margin-bottom:6px;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  justify-content:center;
  align-items:center;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:9999;
}
.modal.active{
  opacity:1;
  pointer-events:auto;
}
.modal-content{
  background:#1e1e1e;
  color:white;
  padding:20px;
  border-radius:12px;
  max-width:90vw;
  max-height:90vh;
  position:relative;
}
.modal-content video,
.modal-content img,
.modal-content iframe{
  max-width:80vw;
  max-height:80vh;
  display:block;
  margin:0 auto;
}
.close-btn{
  position:absolute;
  top:8px;
  right:12px;
  background:#ff4c4c;
  border:none;
  color:white;
  padding:4px 10px;
  border-radius:6px;
  cursor:pointer;
}
/* ===== 密碼格固定尺寸 ===== */
.pwd {
  width: 50px;
  height: 50px;
  font-size: 24px;
  text-align: center;
  line-height: 50px; /* 垂直置中 */
  border-radius: 6px;
  border: 1px solid #ccc;
  background: #fff;
  color: #000;
}
#pwdConfirm{
  display:block;
  margin:10px auto 0 auto;
  padding:4px 12px;
  border:none;
  border-radius:6px;
  background:#0a64ad;
  color:white;
  cursor:pointer;
}
.folder-window{
  display:none;
  position:fixed;
  top:50px; left:50px;
  width:600px; height:400px;
  background:#c0d6f7;
  border:1px solid #000;
  box-shadow:2px 2px 10px rgba(0,0,0,0.5);
  z-index:10;
}
.folder-titlebar{
  background:#0a64ad; color:white;
  display:flex; justify-content:space-between; align-items:center;
  padding:2px 6px;
  cursor:move;
}
.folder-content{
  padding:10px;
  display:flex; flex-wrap:wrap; gap:12px;
  overflow:auto; height:calc(100% - 28px);
}
.folder-icon{
  width:80px; text-align:center; cursor:pointer;
}
.folder-icon img{
  width:48px; height:48px; margin-bottom:6px;
}

/* 日曆左右控制樣式 */
.gallery-container{
  position:relative;
}
.gallery-btn{
  position:absolute;
  top:0; bottom:0;
  width:33.33%;
  display:flex; align-items:center; justify-content:center;
  font-size:48px;
  color:white;
  background:rgba(0,0,0,0.3);
  opacity:0;
  cursor:pointer;
  transition:opacity .2s;
  user-select:none;
}
.gallery-container:hover .gallery-btn{opacity:1;}
.gallery-btn.left{left:0;}
.gallery-btn.right{right:0;}
</style>
</head>
<body>

<div class="desktop">
  <div class="icon" data-type="image" data-src="/department0314/images/PC.png">
    <img src="/department0314/icons/Desktop.png">我的電腦
  </div>

  <div class="icon" id="trash">
    <img src="/department0314/icons/Trash.png">資源回收桶
  </div>

  <div class="icon"
       data-type="query"
       data-hint="請輸入檔案編號">
    <img src="/department0314/icons/query.png">查詢系統
  </div>
</div>

<!-- ===== Modal 結構 ===== -->
<div class="modal" id="modal">
  <div class="modal-content" id="modalBody">
    <button class="close-btn" id="closeBtn">X</button>
  </div>
</div>

<script>
/* ===== Modal 基礎 ===== */
const modal = document.getElementById('modal');
const modalBody = document.getElementById('modalBody');
const closeBtn = document.getElementById('closeBtn');
closeBtn.onclick = () => closeModal();

function openModal(html){
  modalBody.innerHTML = `<button class="close-btn" id="closeBtn">X</button>` + html;
  modal.classList.add('active');
  document.getElementById('closeBtn').onclick = closeModal;
}
function closeModal(){
  modal.classList.remove('active');
  modalBody.innerHTML = '';
  document.onkeydown = null;
}

/* ===== 禁右鍵 ===== */
document.addEventListener('contextmenu', e=>e.preventDefault());

/* ===== 檔案編號對應圖片 ===== */
const fileMap = {
  "GHMA-114-DRAFT": [
    "/department0314/images/query01.jpg",
    "/department0314/images/query02.jpg"
  ],
  "ABCD-123-XYZ": [
    "/department0314/images/fileA1.jpg",
    "/department0314/images/fileA2.jpg"
  ],
  "TEST-000-IMG": [
    "/department0314/images/test1.jpg"
  ]
};

/* ===== 查詢系統 ===== */
function querySystemGate({onSuccess}) {
  openModal(`
    <p style="text-align:center">請輸入檔案編號</p>
    <div style="display:flex;justify-content:center;gap:4px;font-size:22px;">
      ${'<input class="pwd start" maxlength="1">'.repeat(4)}
      <span style="line-height:50px;">-</span>
      ${'<input class="pwd mid" maxlength="1">'.repeat(3)}
      <span style="line-height:50px;">-</span>
      ${'<input class="pwd end" maxlength="1">'.repeat(5)}
    </div>
    <button id="pwdConfirm">確定</button>
  `);

  const starts = [...modalBody.querySelectorAll('.start')];
  const mids = [...modalBody.querySelectorAll('.mid')];
  const ends = [...modalBody.querySelectorAll('.end')];
  const inputs = [...starts, ...mids, ...ends];

  inputs.forEach((input,idx)=>{
    input.addEventListener('input',()=>{
      if(input.classList.contains('mid')){
        input.value = input.value.replace(/\D/g,''); // 只允許數字
      } else {
        input.value = input.value.replace(/[^A-Z]/g,'').toUpperCase(); // 只允許大寫英文
      }
      if(input.value && inputs[idx+1]) inputs[idx+1].focus();
    });

    input.addEventListener('keydown', e=>{
      if(e.key==='Backspace' && !input.value && idx>0){
        inputs[idx-1].focus();
      }
    });
  });

  function showErrorModal(){
    openModal(`
      <div style="background:#1e1e1e;color:white;padding:20px;border-radius:12px;text-align:center;">
        <p>查無此檔案！</p>
        <button id="retryBtn" style="padding:6px 12px;margin-top:12px;background:#0a64ad;color:white;border:none;border-radius:6px;cursor:pointer;">重試</button>
      </div>
    `);
    document.getElementById('retryBtn').onclick = ()=>querySystemGate({onSuccess});
  }

  function check(){
    const startVal = starts.map(i=>i.value).join('');
    const midVal = mids.map(i=>i.value).join('');
    const endVal = ends.map(i=>i.value).join('');
    const val = `${startVal}-${midVal}-${endVal}`;

    if(fileMap[val]){
      onSuccess(fileMap[val]);
    } else {
      showErrorModal();
    }
  }

  document.getElementById('pwdConfirm').onclick = check;
  document.onkeydown = e=>{ if(e.key==='Enter') check(); };
}

/* ===== icon 行為 ===== */
document.querySelectorAll('.icon').forEach(icon=>{
  icon.addEventListener('click',()=>{
    const type = icon.dataset.type;
    if(type === 'query'){
      querySystemGate({
        onSuccess: (images)=>openGallery(images)
      });
    }
    if(type === 'image'){
      openModal(`<img src="${icon.dataset.src}" style="max-width:90vw;max-height:90vh;">`);
    }
  });
});

/* ===== Gallery 基礎 ===== */
function openGallery(images){
  let i = 0;
  const render = ()=>{
    openModal(`
      <div class="gallery-container">
        <div class="gallery-btn left">&#10094;</div>
        <img src="${images[i]}" style="max-width:80vw;max-height:80vh;display:block;margin:0 auto;">
        <div class="gallery-btn right">&#10095;</div>
        <p style="text-align:center;">${i+1}/${images.length}</p>
      </div>
    `);
    const c = modalBody.querySelector('.gallery-container');
    c.querySelector('.left').onclick = ()=>{ i=(i-1+images.length)%images.length; render(); };
    c.querySelector('.right').onclick = ()=>{ i=(i+1)%images.length; render(); };
  };
  render();
}
</script>

</body>
</html>
